!function(ctx){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input);return output.join("")}var sprintf=function(){return sprintf.cache.hasOwnProperty(arguments[0])||(sprintf.cache[arguments[0]]=sprintf.parse(arguments[0])),sprintf.format.call(null,sprintf.cache[arguments[0]],arguments)};sprintf.format=function(parse_tree,argv){var arg,i,k,match,pad,pad_character,pad_length,cursor=1,tree_length=parse_tree.length,node_type="",output=[];for(i=0;tree_length>i;i++)if(node_type=get_type(parse_tree[i]),"string"===node_type)output.push(parse_tree[i]);else if("array"===node_type){if(match=parse_tree[i],match[2])for(arg=argv[cursor],k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k]))throw sprintf('[sprintf] property "%s" does not exist',match[2][k]);arg=arg[match[2][k]]}else arg=match[1]?argv[match[1]]:argv[cursor++];if(/[^s]/.test(match[8])&&"number"!=get_type(arg))throw sprintf("[sprintf] expecting number but found %s",get_type(arg));switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg>>>=0;break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase()}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg,pad_character=match[4]?"0"==match[4]?"0":match[4].charAt(1):" ",pad_length=match[6]-String(arg).length,pad=match[6]?str_repeat(pad_character,pad_length):"",output.push(match[5]?arg+pad:pad+arg)}return output.join("")},sprintf.cache={},sprintf.parse=function(fmt){for(var _fmt=fmt,match=[],parse_tree=[],arg_names=0;_fmt;){if(null!==(match=/^[^\x25]+/.exec(_fmt)))parse_tree.push(match[0]);else if(null!==(match=/^\x25{2}/.exec(_fmt)))parse_tree.push("%");else{if(null===(match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt)))throw"[sprintf] huh?";if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if(null===(field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field)))throw"[sprintf] huh?";for(field_list.push(field_match[1]);""!==(replacement_field=replacement_field.substring(field_match[0].length));)if(null!==(field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field)))field_list.push(field_match[1]);else{if(null===(field_match=/^\[(\d+)\]/.exec(replacement_field)))throw"[sprintf] huh?";field_list.push(field_match[1])}match[2]=field_list}else arg_names|=2;if(3===arg_names)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";parse_tree.push(match)}_fmt=_fmt.substring(match[0].length)}return parse_tree};var vsprintf=function(fmt,argv,_argv){return _argv=argv.slice(0),_argv.splice(0,0,fmt),sprintf.apply(null,_argv)};ctx.sprintf=sprintf,ctx.vsprintf=vsprintf}("undefined"!=typeof exports?exports:window),function($,undefined){"use strict";function wls(n,v){var c;if("string"==typeof n&&"string"==typeof v)return localStorage[n]=v,!0;if("object"==typeof n&&"undefined"==typeof v){for(c in n)n.hasOwnProperty(c)&&(localStorage[c]=n[c]);return!0}return!1}function wc(n,v){var dt,e,c;if(dt=new Date,dt.setTime(dt.getTime()+31536e6),e="; expires="+dt.toGMTString(),"string"==typeof n&&"string"==typeof v)return document.cookie=n+"="+v+e+"; path=/",!0;if("object"==typeof n&&"undefined"==typeof v){for(c in n)n.hasOwnProperty(c)&&(document.cookie=c+"="+n[c]+e+"; path=/");return!0}return!1}function rls(n){return localStorage[n]}function rc(n){var nn,ca,i,c;for(nn=n+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(c=ca[i];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(nn))return c.substring(nn.length,c.length)}return null}function dls(n){return delete localStorage[n]}function dc(n){return wc(n,"",-1)}function str_parts(str,length){var result=[],len=str.length;if(length>len)return[str];for(var i=0;len>i;i+=length)result.push(str.substring(i,i+length));return result}function Cycle(init){var data=init?[init]:[],pos=0;$.extend(this,{get:function(){return data},rotate:function(){return 1===data.length?data[0]:(pos===data.length-1?pos=0:++pos,data[pos])},length:function(){return data.length},set:function(item){for(var i=data.length;i--;)if(data[i]===item)return void(pos=i);this.append(item)},front:function(){return data[pos]},append:function(item){data.push(item)}})}function Stack(init){var data=init?[init]:[];$.extend(this,{map:function(fn){return $.map(data,fn)},size:function(){return data.length},pop:function(){if(0===data.length)return null;var value=data[data.length-1];return data=data.slice(0,data.length-1),value},push:function(value){return data=data.concat([value]),value},top:function(){return data.length>0?data[data.length-1]:null}})}function History(name,size){var enabled=!0,storage_key="";"string"==typeof name&&""!==name&&(storage_key=name+"_"),storage_key+="commands";var data=$.Storage.get(storage_key);data=data?$.parseJSON(data):[];var pos=data.length-1;$.extend(this,{append:function(item){enabled&&data[data.length-1]!==item&&(data.push(item),size&&data.length>size&&(data=data.slice(-size)),pos=data.length-1,$.Storage.set(storage_key,$.json_stringify(data)))},data:function(){return data},reset:function(){pos=data.length-1},last:function(){return data[length-1]},end:function(){return pos===data.length-1},position:function(){return pos},current:function(){return data[pos]},next:function(){return pos<data.length-1&&++pos,-1!==pos?data[pos]:void 0},previous:function(){var old=pos;return pos>0&&--pos,-1!==old?data[pos]:void 0},clear:function(){data=[],this.purge()},enabled:function(){return enabled},enable:function(){enabled=!0},purge:function(){$.Storage.remove(storage_key)},disable:function(){enabled=!1}})}function skipFormattingCount(string){return $("<div>"+$.terminal.strip(string)+"</div>").text().length}function supportAnimations(){var animation=!1,animationstring="animation",keyframeprefix="",domPrefixes="Webkit Moz O ms Khtml".split(" "),pfx="",elm=document.createElement("div");if(elm.style.animationName&&(animation=!0),animation===!1)for(var i=0;i<domPrefixes.length;i++)if(elm.style[domPrefixes[i]+"AnimationName"]!==undefined){pfx=domPrefixes[i],animationstring=pfx+"Animation",keyframeprefix="-"+pfx.toLowerCase()+"-",animation=!0;break}return animation}function processCommand(string,fn){var args=string.replace(/^\s+|\s+$/g,"").split(/(\s+)/),rest=string.replace(/^[^\s]+\s*/,"");return{name:args[0],args:fn(rest),rest:rest}}function is_scrolled_into_view(elem){var docViewTop=$(window).scrollTop(),docViewBottom=docViewTop+$(window).height(),elemTop=$(elem).offset().top,elemBottom=elemTop+$(elem).height();return elemBottom>=docViewTop&&docViewBottom>=elemTop}function char_size(){var temp=$('<div class="terminal temp"><div class="cmd"><span class="cursor">&nbsp;</span></div></div>').appendTo("body"),span=temp.find("span"),result={width:span.width(),height:span.outerHeight()};return temp.remove(),result}function get_num_chars(terminal){for(var temp=$('<div class="terminal wrap"><span class="cursor"></span></div>').appendTo("body").css("padding",0),span=temp.find("span"),max=60,spaces="",i=0;max>=i;++i)spaces+="&nbsp;";span.html(spaces);var width=span.width()/max,result=Math.floor(terminal.width()/width);if(temp.remove(),have_scrollbars(terminal)){var SCROLLBAR_WIDTH=20,margins=terminal.innerWidth()-terminal.width();result-=Math.ceil((SCROLLBAR_WIDTH-margins/2)/(width-1))}return result}function get_num_rows(terminal){return Math.floor(terminal.height()/char_size().height)}function getSelectedText(){if(window.getSelection||document.getSelection){var selection=(window.getSelection||document.getSelection)();return selection.text?selection.text:selection.toString()}return document.selection?document.selection.createRange().text:void 0}function have_scrollbars(div){return div.get(0).scrollHeight>div.innerHeight()}$.omap=function(o,fn){var result={};return $.each(o,function(k,v){result[k]=fn.call(o,k,v)}),result};var isLS="undefined"!=typeof window.localStorage;$.extend({Storage:{set:isLS?wls:wc,get:isLS?rls:rc,remove:isLS?dls:dc}}),jQuery.fn.extend({everyTime:function(interval,label,fn,times,belay){return this.each(function(){jQuery.timer.add(this,interval,label,fn,times,belay)})},oneTime:function(interval,label,fn){return this.each(function(){jQuery.timer.add(this,interval,label,fn,1)})},stopTime:function(label,fn){return this.each(function(){jQuery.timer.remove(this,label,fn)})}}),jQuery.extend({timer:{guid:1,global:{},regex:/^([0-9]+)\s*(.*s)?$/,powers:{ms:1,cs:10,ds:100,s:1e3,das:1e4,hs:1e5,ks:1e6},timeParse:function(value){if(value===undefined||null===value)return null;var result=this.regex.exec(jQuery.trim(value.toString()));if(result[2]){var num=parseInt(result[1],10),mult=this.powers[result[2]]||1;return num*mult}return value},add:function(element,interval,label,fn,times,belay){var counter=0;if(jQuery.isFunction(label)&&(times||(times=fn),fn=label,label=interval),interval=jQuery.timer.timeParse(interval),!("number"!=typeof interval||isNaN(interval)||0>=interval)){times&&times.constructor!==Number&&(belay=!!times,times=0),times=times||0,belay=belay||!1,element.$timers||(element.$timers={}),element.$timers[label]||(element.$timers[label]={}),fn.$timerID=fn.$timerID||this.guid++;var handler=function(){belay&&handler.inProgress||(handler.inProgress=!0,(++counter>times&&0!==times||fn.call(element,counter)===!1)&&jQuery.timer.remove(element,label,fn),handler.inProgress=!1)};handler.$timerID=fn.$timerID,element.$timers[label][fn.$timerID]||(element.$timers[label][fn.$timerID]=window.setInterval(handler,interval)),this.global[label]||(this.global[label]=[]),this.global[label].push(element)}},remove:function(element,label,fn){var ret,timers=element.$timers;if(timers){if(label){if(timers[label]){if(fn)fn.$timerID&&(window.clearInterval(timers[label][fn.$timerID]),delete timers[label][fn.$timerID]);else for(var _fn in timers[label])timers[label].hasOwnProperty(_fn)&&(window.clearInterval(timers[label][_fn]),delete timers[label][_fn]);for(ret in timers[label])if(timers[label].hasOwnProperty(ret))break;ret||(ret=null,delete timers[label])}}else for(var lab in timers)timers.hasOwnProperty(lab)&&this.remove(element,lab,fn);for(ret in timers)if(timers.hasOwnProperty(ret))break;ret||(element.$timers=null)}}}}),/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&jQuery(window).one("unload",function(){var global=jQuery.timer.global;for(var label in global)if(global.hasOwnProperty(label))for(var els=global[label],i=els.length;--i;)jQuery.timer.remove(els[i],label)}),function(undef){if(String.prototype.split.toString().match(/\[native/)){var self,nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undef;return self=function(str,separator,limit){if("[object RegExp]"!==Object.prototype.toString.call(separator))return nativeSplit.call(str,separator,limit);var separator2,match,lastIndex,lastLength,output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.extended?"x":"")+(separator.sticky?"y":""),lastLastIndex=0;for(separator=new RegExp(separator.source,flags+"g"),str+="",compliantExecNpcg||(separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags)),limit=limit===undef?-1>>>0:limit>>>0;(match=separator.exec(str))&&(lastIndex=match.index+match[0].length,!(lastIndex>lastLastIndex&&(output.push(str.slice(lastLastIndex,match.index)),!compliantExecNpcg&&match.length>1&&match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++)arguments[i]===undef&&(match[i]=undef)}),match.length>1&&match.index<str.length&&Array.prototype.push.apply(output,match.slice(1)),lastLength=match[0].length,lastLastIndex=lastIndex,output.length>=limit)));)separator.lastIndex===match.index&&separator.lastIndex++;return lastLastIndex===str.length?(lastLength||!separator.test(""))&&output.push(""):output.push(str.slice(lastLastIndex)),output.length>limit?output.slice(0,limit):output},String.prototype.split=function(separator,limit){return self(this,separator,limit)},self}}(),$.json_stringify=function(object,level){var i,result="";level=level===undefined?1:level;var type=typeof object;switch(type){case"function":result+=object;break;case"boolean":result+=object?"true":"false";break;case"object":if(null===object)result+="null";else if(object instanceof Array){result+="[";var len=object.length;for(i=0;len-1>i;++i)result+=$.json_stringify(object[i],level+1);result+=$.json_stringify(object[len-1],level+1)+"]"}else{result+="{";for(var property in object)object.hasOwnProperty(property)&&(result+='"'+property+'":'+$.json_stringify(object[property],level+1));result+="}"}break;case"string":var str=object,repl={"\\\\":"\\\\",'"':'\\"',"/":"\\/","\\n":"\\n","\\r":"\\r","\\t":"\\t"};for(i in repl)repl.hasOwnProperty(i)&&(str=str.replace(new RegExp(i,"g"),repl[i]));result+='"'+str+'"';break;case"number":result+=String(object)}return result+=level>1?",":"",1===level&&(result=result.replace(/,([\]}])/g,"$1")),result.replace(/([\[{]),/g,"$1")},$.fn.cmd=function(options){function blink(i){cursor.toggleClass("inverted")}function draw_reverse_prompt(){prompt="(reverse-i-search)`"+reverse_search_string+"': ",draw_prompt()}function clear_reverse_state(){prompt=backup_prompt,reverse_search=!1,reverse_search_position=null,reverse_search_string=""}function reverse_history_search(next){var regex,save_string,history_data=history.data(),len=history_data.length;if(next&&reverse_search_position>0&&(len-=reverse_search_position),reverse_search_string.length>0)for(var j=reverse_search_string.length;j>0;j--){save_string=reverse_search_string.substring(0,j).replace(/([.*+{}\[\]?])/g,"\\$1"),regex=new RegExp(save_string);for(var i=len;i--;)if(regex.test(history_data[i]))return reverse_search_position=history_data.length-i,position=0,self.set(history_data[i],!0),redraw(),void(reverse_search_string.length!==j&&(reverse_search_string=reverse_search_string.substring(0,j),draw_reverse_prompt()))}reverse_search_string=""}function change_num_chars(){var W=self.width(),w=cursor.innerWidth();num_chars=Math.floor(W/w)}function get_splited_command_line(string){var first=string.substring(0,num_chars-prompt_len),rest=string.substring(num_chars-prompt_len);return[first].concat(str_parts(rest,num_chars))}function paste(){clip.focus(),self.oneTime(1,function(){self.insert(clip.val()),clip.blur().val("")})}function keydown_event(e){var result,pos,len;if("function"==typeof options.keydown&&(result=options.keydown(e),result!==undefined))return result;if(enabled){if(38===e.which||80===e.which&&e.ctrlKey||(first_up_history=!0),!reverse_search||35!==e.which&&36!==e.which&&37!==e.which&&38!==e.which&&39!==e.which&&40!==e.which&&13!==e.which&&27!==e.which){if(e.altKey)return 68===e.which?(self.set(command.slice(0,position)+command.slice(position).replace(/[^ ]+ |[^ ]+$/,""),!0),!1):!0;if(13===e.keyCode)if(e.shiftKey)self.insert("\n");else{history&&command&&!mask&&("function"==typeof options.historyFilter&&options.historyFilter(command)||!options.historyFilter)&&history.append(command);var tmp=command;history.reset(),self.set(""),options.commands&&options.commands(tmp),"function"==typeof prompt&&draw_prompt()}else if(8===e.which)reverse_search?(reverse_search_string=reverse_search_string.slice(0,-1),draw_reverse_prompt()):""!==command&&position>0&&(command=command.slice(0,position-1)+command.slice(position,command.length),--position,redraw());else if(67===e.which&&e.ctrlKey&&e.shiftKey)selected_text=getSelectedText();else if(86===e.which&&e.ctrlKey&&e.shiftKey)""!==selected_text&&self.insert(selected_text);else if(9!==e.which||e.ctrlKey||e.altKey){if(46===e.which)return""!==command&&position<command.length&&(command=command.slice(0,position)+command.slice(position+1,command.length),redraw()),!0;if(history&&38===e.which||80===e.which&&e.ctrlKey)first_up_history?(last_command=command,self.set(history.current())):self.set(history.previous()),first_up_history=!1;else if(history&&40===e.which||78===e.which&&e.ctrlKey)self.set(history.end()?last_command:history.next());else if(37===e.which||66===e.which&&e.ctrlKey)if(e.ctrlKey&&66!==e.which){len=position-1,pos=0," "===command[len]&&--len;for(var i=len;i>0;--i){if(" "===command[i]&&" "!==command[i+1]){pos=i+1;break}if("\n"===command[i]&&"\n"!==command[i+1]){pos=i;break}}self.position(pos)}else position>0&&(--position,redraw());else if(82===e.which&&e.ctrlKey)reverse_search?reverse_history_search(!0):(backup_prompt=prompt,draw_reverse_prompt(),last_command=command,command="",redraw(),reverse_search=!0);else if(71==e.which&&e.ctrlKey)reverse_search&&(prompt=backup_prompt,draw_prompt(),command=last_command,redraw(),reverse_search=!1,reverse_search_string="");else if(39===e.which||70===e.which&&e.ctrlKey)if(e.ctrlKey&&70!==e.which){" "===command[position]&&++position;var re=/\S[\n\s]{2,}|[\n\s]+\S?/,match=command.slice(position).match(re);!match||match[0].match(/^\s+$/)?position=command.length:" "!==match[0][0]?position+=match.index+1:(position+=match.index+match[0].length-1," "!==match[0][match[0].length-1]&&--position),redraw()}else position<command.length&&(++position,redraw());else{if(123===e.which)return!0;if(36===e.which)self.position(0);else if(35===e.which)self.position(command.length);else{if(e.shiftKey&&45==e.which)return paste(),!0;if(!e.ctrlKey&&!e.metaKey)return!0;if(192===e.which)return!0;if(e.metaKey){if(82===e.which)return!0;if(76===e.which)return!0}if(e.shiftKey){if(84===e.which)return!0}else{if(81===e.which){if(""!==command&&0!==position){var first=command.slice(0,position),last=command.slice(position+1),m=first.match(/([^ ]+ *$)/);position=first.length-m[0].length,kill_text=first.slice(position),command=first.slice(0,position)+last,redraw()}return!1}if(72===e.which)return""!==command&&position>0&&(command=command.slice(0,--position),position<command.length-1&&(command+=command.slice(position)),redraw()),!1;if(65===e.which)self.position(0);else if(69===e.which)self.position(command.length);else{if(88===e.which||67===e.which||84===e.which)return!0;if(89===e.which)""!==kill_text&&self.insert(kill_text);else{if(86===e.which)return paste(),!0;if(75===e.which)0===position?(kill_text=command,self.set("")):position!==command.length&&(kill_text=command.slice(position),self.set(command.slice(0,position)));else if(85===e.which)""!==command&&0!==position&&(kill_text=command.slice(0,position),self.set(command.slice(position,command.length)),self.position(0));else if(17===e.which)return!1}}}}}}else self.insert("	")}else clear_reverse_state(),draw_prompt(),27===e.which&&(command=""),redraw(),keydown_event.call(this,e);return!1}}var self=this,maybe_data=self.data("cmd");if(maybe_data)return maybe_data;self.addClass("cmd"),self.append('<span class="prompt"></span><span></span><span class="cursor">&nbsp;</span><span></span>');var clip=$("<textarea/>").addClass("clipboard").appendTo(self);options.width&&self.width(options.width);var num_chars,prompt_len,backup_prompt,prompt,name,history,animation,reverse_search=!1,reverse_search_string="",reverse_search_position=null,mask=options.mask||!1,command="",selected_text="",kill_text="",position=0,enabled=options.enabled,historySize=options.historySize||60,cursor=self.find(".cursor");animation=supportAnimations()?function(toggle){toggle?cursor.addClass("blink"):cursor.removeClass("blink")}:function(toggle){toggle&&!enabled?(cursor.addClass("inverted"),self.everyTime(500,"blink",blink)):enabled&&(self.stopTime("blink",blink),cursor.removeClass("inverted"))};var last_command,redraw=function(self){function draw_cursor_line(string,position){var len=string.length;if(position===len)before.html($.terminal.encode(string,!0)),cursor.html("&nbsp;"),after.html("");else if(0===position)before.html(""),cursor.html($.terminal.encode(string.slice(0,1),!0)),after.html($.terminal.encode(string.slice(1),!0));else{var before_str=$.terminal.encode(string.slice(0,position),!0);before.html(before_str);var c=string.slice(position,position+1);cursor.html(" "===c?"&nbsp;":$.terminal.encode(c,!0)),position===string.length-1?after.html(""):after.html($.terminal.encode(string.slice(position+1),!0))}}function div(string){return"<div>"+$.terminal.encode(string,!0)+"</div>"}function lines_after(lines){var last_ins=after;$.each(lines,function(i,line){last_ins=$(div(line)).insertAfter(last_ins).addClass("clear")})}function lines_before(lines){$.each(lines,function(i,line){before.before(div(line))})}var before=cursor.prev(),after=cursor.next();return function(){var i,first_len,string=mask?command.replace(/./g,"*"):command;if(self.find("div").remove(),before.html(""),string.length>num_chars-prompt_len-1||string.match(/\n/)){var array,tabs=string.match(/\t/g),tabs_rm=tabs?3*tabs.length:0;if(tabs&&(string=string.replace(/\t/g,"\x00\x00\x00\x00")),string.match(/\n/)){var tmp=string.split("\n");for(first_len=num_chars-prompt_len-1,i=0;i<tmp.length-1;++i)tmp[i]+=" ";for(tmp[0].length>first_len?(array=[tmp[0].substring(0,first_len)],array=array.concat(str_parts(tmp[0].substring(first_len),num_chars))):array=[tmp[0]],i=1;i<tmp.length;++i)tmp[i].length>num_chars?array=array.concat(str_parts(tmp[i],num_chars)):array.push(tmp[i])}else array=get_splited_command_line(string);if(tabs&&(array=$.map(array,function(line){return line.replace(/\x00\x00\x00\x00/g,"	")})),first_len=array[0].length,0===first_len&&1===array.length);else if(first_len>position)draw_cursor_line(array[0],position),lines_after(array.slice(1));else if(position===first_len)before.before(div(array[0])),draw_cursor_line(array[1],0),lines_after(array.slice(2));else{var num_lines=array.length;if(first_len>position)draw_cursor_line(array[0],position),lines_after(array.slice(1));else if(position===first_len)before.before(div(array[0])),draw_cursor_line(array[1],0),lines_after(array.slice(2));else{var last=array.slice(-1)[0],from_last=string.length-position,last_len=last.length,pos=0;if(last_len>=from_last)lines_before(array.slice(0,-1)),pos=last_len===from_last?0:last_len-from_last,draw_cursor_line(last,pos+tabs_rm);else if(3===num_lines)before.before("<div>"+$.terminal.encode(array[0],!0)+"</div>"),draw_cursor_line(array[1],position-first_len-1),after.after('<div class="clear">'+$.terminal.encode(array[2],!0)+"</div>");else{var line_index,current;for(pos=position,i=0;i<array.length;++i){var current_len=array[i].length;if(!(pos>current_len))break;pos-=current_len}current=array[i],line_index=i,pos===current.length&&(pos=0,current=array[++line_index]),draw_cursor_line(current,pos),lines_before(array.slice(0,line_index)),lines_after(array.slice(line_index+1))}}}}else""===string?(before.html(""),cursor.html("&nbsp;"),after.html("")):draw_cursor_line(string,position)}}(self),draw_prompt=function(){function set(prompt){prompt_len=skipFormattingCount(prompt),prompt_node.html($.terminal.format($.terminal.encode(prompt)))}var prompt_node=self.find(".prompt");return function(){switch(typeof prompt){case"string":set(prompt);break;case"function":prompt(set)}}}(),first_up_history=!0;$.extend(self,{name:function(string){if(string!==undefined){name=string;var enabled=history&&history.enabled()||!history;return history=new History(string,historySize),enabled||history.disable(),self}return name},purge:function(){return history.clear(),self},history:function(){return history},set:function(string,stay){return string!==undefined&&(command=string,stay||(position=command.length),redraw(),"function"==typeof options.onCommandChange&&options.onCommandChange(command)),self},insert:function(string,stay){return position===command.length?command+=string:command=0===position?string+command:command.slice(0,position)+string+command.slice(position),stay||(position+=string.length),redraw(),"function"==typeof options.onCommandChange&&options.onCommandChange(command),self},get:function(){return command},commands:function(commands){return commands?(options.commands=commands,self):commands},destroy:function(){return $(document.documentElement||window).unbind(".cmd"),self.stopTime("blink",blink),self.find(".cursor").next().remove().end().prev().remove().end().remove(),self.find(".prompt, .clipboard").remove(),self.removeClass("cmd").removeData("cmd"),self},prompt:function(user_prompt){if(user_prompt===undefined)return prompt;if("string"!=typeof user_prompt&&"function"!=typeof user_prompt)throw"prompt must be a function or string";return prompt=user_prompt,draw_prompt(),redraw(),self},kill_text:function(){return kill_text},position:function(n){return"number"==typeof n?(position=0>n?0:n>command.length?command.length:n,redraw(),self):position},visible:function(){var visible=self.visible;return function(){visible.apply(self,[]),redraw(),draw_prompt()}}(),show:function(){var show=self.show;return function(){show.apply(self,[]),redraw(),draw_prompt()}}(),resize:function(num){return num?num_chars=num:change_num_chars(),redraw(),self},enable:function(){return enabled=!0,animation(!0),self},isenabled:function(){return enabled},disable:function(){return enabled=!1,animation(!1),self},mask:function(display){return"boolean"==typeof display?(mask=display,redraw(),self):mask}}),self.name(options.name||options.prompt||""),prompt=options.prompt||"> ",draw_prompt(),(options.enabled===undefined||options.enabled===!0)&&self.enable();return $(document.documentElement||window).bind("keypress.cmd",function(e){var result;if(e.ctrlKey&&99===e.which)return!0;if(reverse_search||"function"!=typeof options.keypress||(result=options.keypress(e)),result!==undefined&&!result)return result;if(enabled){if($.inArray(e.which,[38,13,0,8])>-1&&123!==e.keyCode&&(38!==e.which||!e.shiftKey))return!1;if(!e.ctrlKey&&(!e.altKey||100!==e.which)||e.altKey)return reverse_search?(reverse_search_string+=String.fromCharCode(e.which),reverse_history_search(),draw_reverse_prompt()):self.insert(String.fromCharCode(e.which)),!1}}).bind("keydown.cmd",keydown_event),self.data("cmd",self),self};var color_names=["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],format_split_re=/(\[\[[gbiuso]*;[^;]*;[^\]]*\](?:[^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?)/i,format_parts_re=/\[\[([gbiuso]*);([^;]*);([^;\]]*);?([^;\]]*);?([^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,format_re=/\[\[([gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]?/gi,format_full_re=/^\[\[([gbiuso]*;[^;\]]*;[^;\]]*(?:;|[^\]()]*);?[^\]]*)\]([^\]]*\\\][^\]]*|[^\]]*|[^\[]*\[[^\]]*)\]$/gi,color_hex_re=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i,url_re=/\bhttps?:\/\/(?:(?!&[^;]+;)[^\s"'<>)])+\b/g,email_re=/((([^<>('")[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,})))/g,command_re=/('[^']*'|"(\\"|[^"])*"|\/(\\\/|[^\/])+\/[gimy]*|(\\ |[^ ])+|[\w-]+)/g,format_begin_re=/(\[\[[gbiuso]*;[^;]*;[^\]]*\])/i,format_last_re=/\[\[[gbiuso]*;[^;]*;[^\]]*\]?$/i;$.terminal={valid_color:function(color){return color.match(color_hex_re)||-1!==$.inArray(color.toLowerCase(),color_names)},escape_regex:function(string){var special=/([\^\$\[\]\(\)\+\*\.\|])/g;return string.replace(special,"\\$1")},have_formatting:function(str){return str.match(format_re)},is_formatting:function(str){return str.match(format_full_re)},format_split:function(str){return str.split(format_split_re)},split_equal:function(str,length){for(var formatting=!1,in_text=!1,prev_format="",result=[],array=str.replace(format_re,function(_,format,text){var semicolons=format.match(/;/g).length;return semicolons=2==semicolons?";;":3==semicolons?";":"","[["+format+semicolons+text.replace(/\\\]/g,"&#93;").replace(/\n/g,"\\n")+"]"+text+"]"}).split(/\n/g),i=0,len=array.length;len>i;++i)if(""!==array[i])for(var line=array[i],first_index=0,count=0,j=0,jlen=line.length;jlen>j;++j){if("["===line[j]&&"["===line[j+1])formatting=!0;else if(formatting&&"]"===line[j])in_text?(formatting=!1,in_text=!1):in_text=!0;else if(formatting&&in_text||!formatting){if("&"===line[j]){var m=line.substring(j).match(/^(&[^;]+;)/);if(!m)throw"Unclosed html entity in line "+(i+1)+" at char "+(j+1);j+=m[1].length-2,j===jlen-1&&result.push(output_line+m[1]);continue}"]"===line[j]&&"\\"===line[j-1]?--count:++count}if(count===length||j===jlen-1){var output_line=line.substring(first_index,j+1);prev_format&&(output_line=prev_format+output_line,output_line.match("]")&&(prev_format="")),first_index=j+1,count=0;var matched=output_line.match(format_re);if(matched){var last=matched[matched.length-1];if("]"!==last[last.length-1])prev_format=last.match(format_begin_re)[1],output_line+="]";else if(output_line.match(format_last_re)){var line_len=output_line.length;line_len-last[last.length-1].length;output_line=output_line.replace(format_last_re,""),prev_format=last.match(format_begin_re)[1]}}result.push(output_line)}}else result.push("");return result},encode:function(str,full){return str=full?str.replace(/&(?![^=]+=)/g,"&amp;"):str.replace(/&(?!#[0-9]+;|[a-zA-Z]+;|[^= "]+=[^=])/g,"&amp;"),str.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")},format:function(str,options){var settings=$.extend({},{linksNoReferrer:!1},options||{});if("string"==typeof str){var splited=$.terminal.format_split(str);return splited&&splited.length>1&&(str=$.map(splited,function(text){return""===text?text:"["===text.substring(0,1)?text.replace(format_parts_re,function(s,style,color,background,_class,data_text,text){if(""===text)return"";text=text.replace(/\\]/g,"]");var style_str="";-1!==style.indexOf("b")&&(style_str+="font-weight:bold;");var text_decoration=[];-1!==style.indexOf("u")&&text_decoration.push("underline"),-1!==style.indexOf("s")&&text_decoration.push("line-through"),-1!==style.indexOf("o")&&text_decoration.push("overline"),text_decoration.length&&(style_str+="text-decoration:"+text_decoration.join(" ")+";"),-1!==style.indexOf("i")&&(style_str+="font-style:italic;"),$.terminal.valid_color(color)&&(style_str+="color:"+color+";",
-1!==style.indexOf("g")&&(style_str+="text-shadow:0 0 5px "+color+";")),$.terminal.valid_color(background)&&(style_str+="background-color:"+background);var data;data=""===data_text?text:data_text.replace(/&#93;/g,"]");var result='<span style="'+style_str+'"'+(""!==_class?' class="'+_class+'"':"")+' data-text="'+data.replace('"',"&quote;")+'">'+text+"</span>";return result}):"<span>"+text+"</span>"}).join("")),$.map(str.split(/(<\/?span[^>]*>)/g),function(string){return string.match(/span/)?string:string.replace(url_re,function(link){var comma=link.match(/\.$/);return link=link.replace(/\.$/,""),'<a target="_blank" '+(settings.linksNoReferer?' rel="noreferrer" ':"")+'href="'+link+'">'+link+"</a>"+(comma?".":"")}).replace(email_re,'<a href="mailto:$1">$1</a>')}).join("").replace(/<span><br\/?><\/span>/g,"<br/>")}return""},escape_brackets:function(string){return string.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")},strip:function(str){return str.replace(format_parts_re,"$6")},active:function(){return terminals.front()},overtyping:function(string){return string.replace(/((?:_\x08.|.\x08_)+)/g,function(full,g){return"[[u;;]"+full.replace(/_x08|\x08_|_\u0008|\u0008_/g,"")+"]"}).replace(/((?:.\x08.)+)/g,function(full,g){return"[[b;#fff;]"+full.replace(/(.)(?:\x08|\u0008)(.)/g,function(full,g1,g2){return g2})+"]"})},ansi_colors:{normal:{black:"#000",red:"#A00",green:"#008400",yellow:"#A50",blue:"#00A",magenta:"#A0A",cyan:"#0AA",white:"#AAA"},faited:{black:"#000",red:"#640000",green:"#006100",yellow:"#737300",blue:"#000087",magenta:"#650065",cyan:"#008787",white:"#818181"},bold:{black:"#000",red:"#F55",green:"#44D544",yellow:"#FF5",blue:"#55F",magenta:"#F5F",cyan:"#5FF",white:"#FFF"},palette:["#000000","#AA0000","#00AA00","#AA5500","#0000AA","#AA00AA","#00AAAA","#AAAAAA","#555555","#FF5555","#55FF55","#FFFF55","#5555FF","#FF55FF","#55FFFF","#FFFFFF","#000000","#00005F","#000087","#0000AF","#0000D7","#0000FF","#005F00","#005F5F","#005F87","#005FAF","#005FD7","#005FFF","#008700","#00875F","#008787","#0087AF","#0087D7","#00AF00","#00AF5F","#00AF87","#00AFAF","#00AFD7","#00AFFF","#00D700","#00D75F","#00D787","#00D7AF","#00D7D7","#00D7FF","#00FF00","#00FF5F","#00FF87","#00FFAF","#00FFD7","#00FFFF","#5F0000","#5F005F","#5F0087","#5F00AF","#5F00D7","#5F00FF","#5F5F00","#5F5F5F","#5F5F87","#5F5FAF","#5F5FD7","#5F5FFF","#5F8700","#5F875F","#5F8787","#5F87AF","#5F87D7","#5F87FF","#5FAF00","#5FAF5F","#5FAF87","#5FAFAF","#5FAFD7","#5FAFFF","#5FD700","#5FD75F","#5FD787","#5FD7AF","#5FD7D7","#5FD7FF","#5FFF00","#5FFF5F","#5FFF87","#5FFFAF","#5FFFD7","#5FFFFF","#870000","#87005F","#870087","#8700AF","#8700D7","#8700FF","#875F00","#875F5F","#875F87","#875FAF","#875FD7","#875FFF","#878700","#87875F","#878787","#8787AF","#8787D7","#8787FF","#87AF00","#87AF5F","#87AF87","#87AFAF","#87AFD7","#87AFFF","#87D700","#87D75F","#87D787","#87D7AF","#87D7D7","#87D7FF","#87FF00","#87FF5F","#87FF87","#87FFAF","#87FFD7","#87FFFF","#AF0000","#AF005F","#AF0087","#AF00AF","#AF00D7","#AF00FF","#AF5F00","#AF5F5F","#AF5F87","#AF5FAF","#AF5FD7","#AF5FFF","#AF8700","#AF875F","#AF8787","#AF87AF","#AF87D7","#AF87FF","#AFAF00","#AFAF5F","#AFAF87","#AFAFAF","#AFAFD7","#AFAFFF","#AFD700","#AFD75F","#AFD787","#AFD7AF","#AFD7D7","#AFD7FF","#AFFF00","#AFFF5F","#AFFF87","#AFFFAF","#AFFFD7","#AFFFFF","#D70000","#D7005F","#D70087","#D700AF","#D700D7","#D700FF","#D75F00","#D75F5F","#D75F87","#D75FAF","#D75FD7","#D75FFF","#D78700","#D7875F","#D78787","#D787AF","#D787D7","#D787FF","#D7AF00","#D7AF5F","#D7AF87","#D7AFAF","#D7AFD7","#D7AFFF","#D7D700","#D7D75F","#D7D787","#D7D7AF","#D7D7D7","#D7D7FF","#D7FF00","#D7FF5F","#D7FF87","#D7FFAF","#D7FFD7","#D7FFFF","#FF0000","#FF005F","#FF0087","#FF00AF","#FF00D7","#FF00FF","#FF5F00","#FF5F5F","#FF5F87","#FF5FAF","#FF5FD7","#FF5FFF","#FF8700","#FF875F","#FF8787","#FF87AF","#FF87D7","#FF87FF","#FFAF00","#FFAF5F","#FFAF87","#FFAFAF","#FFAFD7","#FFAFFF","#FFD700","#FFD75F","#FFD787","#FFD7AF","#FFD7D7","#FFD7FF","#FFFF00","#FFFF5F","#FFFF87","#FFFFAF","#FFFFD7","#FFFFFF","#080808","#121212","#1C1C1C","#262626","#303030","#3A3A3A","#444444","#4E4E4E","#585858","#626262","#6C6C6C","#767676","#808080","#8A8A8A","#949494","#9E9E9E","#A8A8A8","#B2B2B2","#BCBCBC","#C6C6C6","#D0D0D0","#DADADA","#E4E4E4","#EEEEEE"]},from_ansi:function(){function format_ansi(code){var num,controls=code.split(";"),faited=!1,reverse=!1,bold=!1,styles=[],output_color="",output_background="",_8bit_color=!1,_8bit_background=!1,process_8bit=!1,palette=$.terminal.ansi_colors.palette;for(var i in controls){switch(num=parseInt(controls[i],10)){case 1:styles.push("b"),bold=!0,faited=!1;break;case 4:styles.push("u");break;case 3:styles.push("i");break;case 5:process_8bit=!0;break;case 38:_8bit_color=!0;break;case 48:_8bit_background=!0;break;case 2:faited=!0,bold=!1;break;case 7:reverse=!0;break;default:_8bit_color&&process_8bit&&palette[num-1]?output_color=palette[num-1]:color[num]&&(output_color=color[num]),_8bit_background&&process_8bit&&palette[num-1]?output_background=palette[num-1]:background[num]&&(output_background=background[num])}5!==num&&(process_8bit=!1)}if(reverse)if(output_color&&output_background){var tmp=output_background;output_background=output_color,output_color=tmp}else output_color="black",output_background="white";var colors,backgrounds;return colors=backgrounds=bold?$.terminal.ansi_colors.bold:faited?$.terminal.ansi_colors.faited:$.terminal.ansi_colors.normal,[styles.join(""),_8bit_color?output_color:colors[output_color],_8bit_background?output_background:backgrounds[output_background]]}var color={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white",39:"white"},background={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white",49:"black"};return function(input){var splitted=input.split(/(\x1B\[[0-9;]*[A-Za-z])/g);if(1==splitted.length)return input;var output=[];splitted.length>3&&"[0m"==splitted.slice(0,3).join("")&&(splitted=splitted.slice(3));for(var prev_color,prev_background,code,match,inside=!1,i=0;i<splitted.length;++i)if(match=splitted[i].match(/^\x1B\[([0-9;]*)([A-Za-z])$/))switch(match[2]){case"m":if(""===match[1])continue;"0"!==match[1]&&(code=format_ansi(match[1])),inside?(output.push("]"),"0"==match[1]?(inside=!1,prev_color=prev_background=""):(code[1]=code[1]||prev_color,code[2]=code[2]||prev_background,output.push("[["+code.join(";")+"]"),code[1]&&(prev_color=code[1]),code[2]&&(prev_background=code[2]))):"0"!=match[1]&&(inside=!0,output.push("[["+code.join(";")+"]"),code[1]&&(prev_color=code[1]),code[2]&&(prev_background=code[2]))}else output.push(splitted[i]);return inside&&output.push("]"),output.join("")}}(),parseArguments:function(string){return $.map(string.match(command_re)||[],function(arg){if("'"===arg[0]&&"'"===arg[arg.length-1])return arg.replace(/^'|'$/g,"");if('"'===arg[0]&&'"'===arg[arg.length-1])return arg=arg.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"),arg.replace(/\\\\|\\t|\\n/g,function(string){return"t"===string[1]?"	":"n"===string[1]?"\n":"\\"}).replace(/\\x([0-9a-f]+)/gi,function(_,hex){return String.fromCharCode(parseInt(hex,16))}).replace(/\\0([0-7]+)/g,function(_,oct){return String.fromCharCode(parseInt(oct,8))});if(arg.match(/^\/(\\\/|[^\/])+\/[gimy]*$/)){var m=arg.match(/^\/([^\/]+)\/([^\/]*)$/);return new RegExp(m[1],m[2])}return arg.match(/^-?[0-9]+$/)?parseInt(arg,10):arg.match(/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/)?parseFloat(arg):arg.replace(/\\ /g," ")})},splitArguments:function(string){return $.map(string.match(command_re)||[],function(arg){return"'"===arg[0]&&"'"===arg[arg.length-1]?arg.replace(/^'|'$/g,""):'"'===arg[0]&&'"'===arg[arg.length-1]?arg.replace(/^"|"$/g,"").replace(/\\([" ])/g,"$1"):"/"===arg[0]&&"/"==arg[arg.length-1]?arg:arg.replace(/\\ /g," ")})},parseCommand:function(string){return processCommand(string,$.terminal.parseArguments)},splitCommand:function(string){return processCommand(string,$.terminal.splitArguments)},test:function(){function assert(cond,msg){term.echo(msg+" &#91;"+(cond?"[[b;#44D544;]PASS]":"[[b;#FF5555;]FAIL]")+"&#93;")}var term=$.terminal.active();if(!term){term=$("body").terminal($.noop).css("margin",0);var $win=(term.outerHeight()-term.height(),$(window));$win.resize(function(){term.css("height",$(window).height()-20)}).resize()}term.echo("Testing...");var string='name "foo bar" baz /^asd [x]/ str\\ str 10 1e10',cmd=$.terminal.splitCommand(string);assert("name"===cmd.name&&"foo bar"===cmd.args[0]&&"baz"===cmd.args[1]&&"/^asd [x]/"===cmd.args[2]&&"str str"===cmd.args[3]&&"10"===cmd.args[4]&&"1e10"===cmd.args[5],"$.terminal.splitCommand"),cmd=$.terminal.parseCommand(string),assert("name"===cmd.name&&"foo bar"===cmd.args[0]&&"baz"===cmd.args[1]&&"regexp"===$.type(cmd.args[2])&&"^asd [x]"===cmd.args[2].source&&"str str"===cmd.args[3]&&10===cmd.args[4]&&1e10===cmd.args[5],"$.terminal.parseCommand"),string="[2;31;46mFoo[1;3;4;32;45mBar[0m[7mBaz",assert("[[;#640000;#008787]Foo][[biu;#44D544;#F5F]Bar][[;#000;#AAA]Baz]"===$.terminal.from_ansi(string),"$.terminal.from_ansi"),string="[[biugs;#fff;#000]Foo][[i;;;foo]Bar][[ous;;]Baz]",term.echo("$.terminal.format"),assert('<span style="font-weight:bold;text-decoration:underline line-through;font-style:italic;color:#fff;text-shadow:0 0 5px #fff;background-color:#000" data-text="Foo">Foo</span><span style="font-style:italic;" class="foo" data-text="Bar">Bar</span><span style="text-decoration:underline line-through overline;" data-text="Baz">Baz</span>'===$.terminal.format(string),"	formatting"),string="http://terminal.jcubic.pl/examples.php https://www.google.com/?q=jquery%20terminal",assert('<a target="_blank" href="http://terminal.jcubic.pl/examples.php">http://terminal.jcubic.pl/examples.php</a> <a target="_blank" href="https://www.google.com/?q=jquery%20terminal">https://www.google.com/?q=jquery%20terminal</a>'===$.terminal.format(string),"	urls"),string="foo@bar.com baz.quux@example.com",assert('<a href="mailto:foo@bar.com">foo@bar.com</a> <a href="mailto:baz.quux@example.com">baz.quux@example.com</a>'===$.terminal.format(string),"	emails"),string="-_-[[biugs;#fff;#000]Foo]-_-[[i;;;foo]Bar]-_-[[ous;;]Baz]-_-",assert("-_-Foo-_-Bar-_-Baz-_-"===$.terminal.strip(string),"$.terminal.strip"),string="[[bui;#fff;]Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla sed dolor nisl, in suscipit justo. Donec a enim et est porttitor semper at vitae augue. Proin at nulla at dui mattis mattis. Nam a volutpat ante. Aliquam consequat dui eu sem convallis ullamcorper. Nulla suscipit, massa vitae suscipit ornare, tellus] est [[b;;#f00]consequat nunc, quis blandit elit odio eu arcu. Nam a urna nec nisl varius sodales. Mauris iaculis tincidunt orci id commodo. Aliquam] non magna quis [[i;;]tortor malesuada aliquam] eget ut lacus. Nam ut vestibulum est. Praesent volutpat tellus in eros dapibus elementum. Nam laoreet risus non nulla mollis ac luctus [[ub;#fff;]felis dapibus. Pellentesque mattis elementum augue non sollicitudin. Nullam lobortis fermentum elit ac mollis. Nam ac varius risus. Cras faucibus euismod nulla, ac auctor diam rutrum sit amet. Nulla vel odio erat], ac mattis enim.",term.echo("$.terminal.split_equal");for(var cols=[10,40,60,400],i=cols.length;i--;){for(var lines=$.terminal.split_equal(string,cols[i]),success=!0,j=0;j<lines.length;++j)if($.terminal.strip(lines[j]).length>cols[i]){success=!1;break}assert(success,"	split "+cols[i])}}},$.fn.visible=function(){return this.css("visibility","visible")},$.fn.hidden=function(){return this.css("visibility","hidden")};var ids={};$.jrpc=function(url,method,params,success,error){ids[url]=ids[url]||0;var request=$.json_stringify({jsonrpc:"2.0",method:method,params:params,id:++ids[url]});return $.ajax({url:url,data:request,success:function(result,status,jqXHR){var content_type=jqXHR.getResponseHeader("Content-Type");if(!content_type.match(/application\/json/)){if(!console||!console.warn)throw new Error("WARN: Response Content-Type is not application/json");console.warn("Response Content-Type is not application/json")}var json;try{json=$.parseJSON(result)}catch(e){if(!error)throw new Error("Invalid JSON");return void error(jqXHR,"Invalid JSON",e)}success(json,status,jqXHR)},error:error,contentType:"application/json",dataType:"text",async:!0,cache:!1,type:"POST"})};var version="0.8.8",version_set=!version.match(/^\{\{/),copyright="Copyright (c) 2011-2013 Jakub Jankiewicz <http://jcubic.pl>",version_string=version_set?" version "+version:" ",reg=new RegExp(" {"+version_string.length+"}$"),signatures=[["jQuery Terminal","(c) 2011-2013 jcubic"],["jQuery Terminal Emulator"+(version_set?" v. "+version:""),copyright.replace(/ *<.*>/,"")],["jQuery Terminal Emulator"+(version_set?version_string:""),copyright.replace(/^Copyright /,"")],["      _______                 ________                        __","     / / _  /_ ____________ _/__  ___/______________  _____  / /"," __ / / // / // / _  / _/ // / / / _  / _/     / /  \\/ / _ \\/ /","/  / / // / // / ___/ // // / / / ___/ // / / / / /\\  / // / /__","\\___/____ \\\\__/____/_/ \\__ / /_/____/_//_/ /_/ /_/  \\/\\__\\_\\___/","         \\/          /____/                                   ".replace(reg," ")+version_string,copyright],["      __ _____                     ________                              __","     / // _  /__ __ _____ ___ __ _/__  ___/__ ___ ______ __ __  __ ___  / /"," __ / // // // // // _  // _// // / / // _  // _//     // //  \\/ // _ \\/ /","/  / // // // // // ___// / / // / / // ___// / / / / // // /\\  // // / /__","\\___//____ \\\\___//____//_/ _\\_  / /_//____//_/ /_/ /_//_//_/ /_/ \\__\\_\\___/","          \\/              /____/                                          ".replace(reg,"")+version_string,copyright]];$.terminal.defaults={prompt:"> ",history:!0,exit:!0,clear:!0,enabled:!0,historySize:60,checkArity:!0,exceptionHandler:null,cancelableAjax:!0,processArguments:!0,linksNoReferrer:!1,login:null,outputLimit:-1,onAjaxError:null,onRPCError:null,completion:!1,historyFilter:null,onInit:$.noop,onClear:$.noop,onBlur:$.noop,onFocus:$.noop,onTerminalChange:$.noop,onExit:$.noop,keypress:$.noop,keydown:$.noop,strings:{wrongPasswordTryAgain:"Wrong password try again!",wrongPassword:"Wrong password!",ajaxAbortError:"Error while aborting ajax call!",wrongArity:"Wrong number of arguments. Function '%s' expect %s got %s!",commandNotFound:"Command '%s' Not Found!",oneRPCWithIgnore:"You can use only one rpc with ignoreSystemDescribe",oneInterpreterFunction:"You can't use more then one function (rpc with ignoreSystemDescribe is count as one)",loginFunctionMissing:"You don't have login function",noTokenError:"Access denied (no token)",serverResponse:"Server reponse is",wrongGreetings:"Wrong value of greetings parameter",notWhileLogin:"You can't call that function while in login",loginIsNotAFunction:"Authenticate must be a function",canExitError:"You can't exit from main interpeter",invalidCompletion:"Invalid completion",login:"login",password:"password"}};var requests=[],terminals=new Cycle;$.fn.terminal=function(init_interpreter,options){function get_processed_command(command){return"function"==typeof settings.processArguments?processCommand(command,settings.processArguments):settings.processArguments?$.terminal.parseCommand(command):$.terminal.splitCommand(command)}function display_object(object){"string"==typeof object?self.echo(object):object instanceof Array?self.echo($.map(object,function(object){return $.json_stringify(object)}).join(" ")):"object"==typeof object?self.echo($.json_stringify(object)):self.echo(object)}function display_json_rpc_error(error){"function"==typeof settings.onRPCError?settings.onRPCError.call(self,error):self.error("&#91;RPC&#93; "+error.message)}function make_basic_json_rpc_interpreter(url){var service=function(method,params){self.pause(),$.jrpc(url,method,params,function(json){json.error?display_json_rpc_error(json.error):"function"==typeof settings.processRPCResponse?settings.processRPCResponse.call(self,json.result):display_object(json.result),self.resume()},ajax_error)};return function(command,terminal){if(""!==command)if(command=get_processed_command(command),settings.login&&"help"!==command.name){var token=terminal.token();token?service(command.name,[token].concat(command.args)):terminal.error("&#91;AUTH&#93; "+strings.noTokenError)}else service(command.name,command.args)}}function make_object_interpreter(object,arity,fallback){return function(user_command,terminal){if(""!==user_command){var command=get_processed_command(user_command),val=object[command.name],type=$.type(val);if("function"===type){if(!arity||val.length===command.args.length)return val.apply(self,command.args);self.error("&#91;Arity&#93; "+sprintf(strings.wrongArity,command.name,val.length,command.args.length))}else if("object"===type||"string"===type){var commands=[];"object"===type&&(commands=Object.keys(val),val=make_object_interpreter(val,arity)),terminal.push(val,{prompt:command.name+"> ",name:command.name,completion:"object"===type?function(term,string,callback){callback(commands)}:undefined})}else"function"===$.type(fallback)?fallback(user_command,self):"function"===$.type(settings.onCommandNotFound)?settings.onCommandNotFound(user_command,self):terminal.error(sprintf(strings.commandNotFound,command.name))}}}function ajax_error(xhr,status,error){self.resume(),"function"==typeof settings.onAjaxError?settings.onAjaxError.call(self,xhr,status,error):"abort"!==status&&self.error("&#91;AJAX&#93; "+status+" - "+strings.serverResponse+": \n"+xhr.responseText)}function make_json_rpc_object(url,auth,success){$.jrpc(url,"system.describe",[],function(ret){if(ret.procs){var interpreter_object={};$.each(ret.procs,function(_,proc){interpreter_object[proc.name]=function(){var append=auth&&"help"!=proc.name,args=Array.prototype.slice.call(arguments),args_len=args.length+(append?1:0);settings.checkArity&&proc.params&&proc.params.length!==args_len?self.error("&#91;Arity&#93; "+sprintf(strings.wrongArity,proc.name,proc.params.length,args_len)):(self.pause(),append&&(args=[self.token(!0)].concat(args)),$.jrpc(url,proc.name,args,function(json){json.error?display_json_rpc_error(json.error):display_object(json.result),self.resume()},ajax_error))}}),success(interpreter_object)}else success(null)},function(){success(null)})}function make_interpreter(user_interpreter,auth,finalize){finalize=finalize||$.noop;var commands,function_interpreter,type=$.type(user_interpreter),result={},rpc_count=0;if("array"===type){var object={};!function recur(interpreters,success){if(interpreters.length){var first=interpreters[0],rest=interpreters.slice(1),type=$.type(first);"string"===type?(rpc_count++,self.pause(),settings.ignoreSystemDescribe?(1===rpc_count?function_interpreter=make_basic_json_rpc_interpreter(first):self.error(strings.oneRPCWithIgnore),recur(rest,success)):make_json_rpc_object(first,auth,function(new_object){new_object&&$.extend(object,new_object),self.resume(),recur(rest,success)})):"function"===type?function_interpreter?self.error(strings.oneInterpreterFunction):function_interpreter=first:"object"===type&&($.extend(object,first),recur(rest,success))}else success()}(user_interpreter,function(){commands=Object.keys(object),result.interpreter=make_object_interpreter(object,!1,function_interpreter),result.completion=function(term,string,callback){callback(commands)},finalize(result)})}else if("string"===type)settings.ignoreSystemDescribe?finalize({interpreter:make_basic_json_rpc_interpreter(user_interpreter),completion:settings.completion}):(self.pause(),make_json_rpc_object(user_interpreter,auth,function(object){if(object){var commands=Object.keys(object);result.interpreter=make_object_interpreter(object,!1),result.completion=function(term,string,callback){callback(commands)}}else result.interpreter=make_basic_json_rpc_interpreter(user_interpreter),result.completion=settings.completion;self.resume(),finalize(result)}));else if("object"===type)commands=Object.keys(user_interpreter),result.interpreter=make_object_interpreter(user_interpreter,settings.checkArity),result.completion=function(term,string,callback){callback(commands)},finalize(result);else{if("undefined"===type)user_interpreter=$.noop;else if("function"!==type)throw type+" is invalid interpreter value";finalize({interpreter:user_interpreter,completion:settings.completion})}}function make_json_rpc_login(url,login){var method="boolean"===$.type(login)?"login":login;return function(user,passwd,callback,term){self.pause(),$.jrpc(url,method,[user,passwd],function(response){self.resume(),callback(!response.error&&response.result?response.result:null)},ajax_error)}}function exception_message(e){return"string"==typeof e?e:"string"==typeof e.fileName?e.fileName+": "+e.message:e.message}function display_exception(e,label){"function"==typeof settings.exceptionHandler?settings.exceptionHandler.call(self,e):self.exception(e,label)}function scroll_to_bottom(){var scrollHeight=scroll_object.prop?scroll_object.prop("scrollHeight"):scroll_object.attr("scrollHeight");scroll_object.scrollTop(scrollHeight)}function validate(label,object){try{if("function"==typeof object)object(function(){});else if("string"!=typeof object){var msg=label+" must be string or function";throw msg}}catch(e){return display_exception(e,label.toUpperCase()),!1}return!0}function draw_line(string,options){try{var line_settings=$.extend({raw:!1,finalize:$.noop},options||{});string="function"===$.type(string)?string():string,string="string"===$.type(string)?string:String(string);var i,len;if(line_settings.raw||(string=$.terminal.encode(string)),string=$.terminal.overtyping(string),string=$.terminal.from_ansi(string),output_buffer.push(NEW_LINE),!line_settings.raw&&(string.length>num_chars||string.match(/\n/))){var array=$.terminal.split_equal(string,num_chars);for(i=0,len=array.length;len>i;++i)""===array[i]||"\r"===array[i]?output_buffer.push("&nbsp;"):line_settings.raw?output_buffer.push(array[i]):output_buffer.push($.terminal.format(array[i],{linksNoReferer:settings.linksNoReferer}))}else line_settings.raw||(string=$.terminal.format(string,{linksNoReferer:settings.linksNoReferer})),output_buffer.push(string);output_buffer.push(line_settings.finalize)}catch(e){output_buffer=[],alert("[Internal Exception(draw_line)]:"+exception_message(e)+"\n"+e.stack)}}function redraw(){command_line.resize(num_chars);var lines_to_show,o=output.empty().detach();if(settings.outputLimit>=0){var limit=0===settings.outputLimit?self.rows():settings.outputLimit;lines_to_show=lines.slice(lines.length-limit-1)}else lines_to_show=lines;$.each(lines_to_show,function(i,line){draw_line.apply(null,line)}),command_line.before(o),self.flush()}function show_greetings(){if(settings.greetings===undefined)self.echo(self.signature);else if(settings.greetings){var type=typeof settings.greetings;"string"===type?self.echo(settings.greetings):"function"===type?settings.greetings.call(self,self.echo):self.error(strings.wrongGreetings)}}function echo_command(command){command=$.terminal.escape_brackets($.terminal.encode(command,!0));var prompt=command_line.prompt();command_line.mask()&&(command=command.replace(/./g,"*")),"function"==typeof prompt?prompt(function(string){self.echo(string+command)}):self.echo(prompt+command)}function commands(command,silent,exec){try{ghost()||(prev_command=$.terminal.splitCommand(command).name,(exec&&"function"==typeof settings.historyFilter&&settings.historyFilter(command)||!settings.historyFilter)&&command_line.history().append(command));var interpreter=interpreters.top();if("exit"===command&&settings.exit){var count=interpreters.size();self.token(),(1==count&&self.token()||count>1)&&(silent||echo_command(command),self.pop())}else{silent||echo_command(command);var position=lines.length-1;if("clear"===command&&settings.clear)self.clear();else{var result=interpreter.interpreter(command,self);result!==undefined&&(position===lines.length-1?(lines.pop(),result!==!1&&self.echo(result)):lines=result===!1?lines.slice(0,position).concat(lines.slice(position+1)):lines.slice(0,position).concat([result]).concat(lines.slice(position+1)),self.resize())}}}catch(e){throw display_exception(e,"USER"),self.resume(),e}}function global_logout(){if("function"==typeof settings.onBeforeLogout)try{if(settings.onBeforeLogout(self)===!1)return}catch(e){throw display_exception(e,"onBeforeLogout"),e}if(logout(),"function"==typeof settings.onAfterLogout)try{settings.onAfterLogout(self)}catch(e){throw display_exception(e,"onAfterlogout"),e}self.login(settings.login,!0,initialize)}function logout(){var name=self.prefix_name(!0)+"_";$.Storage.remove(name+"token"),$.Storage.remove(name+"login")}function maybe_append_name(interpreter_name){var storage_key=self.prefix_name()+"_interpreters",names=$.Storage.get(storage_key);names=names?$.parseJSON(names):[],-1==$.inArray(interpreter_name,names)&&(names.push(interpreter_name),$.Storage.set(storage_key,$.json_stringify(names)))}function prepare_top_interpreter(silent){var interpreter=interpreters.top(),name=self.prefix_name(!0);ghost()||maybe_append_name(name),command_line.name(name),"function"==typeof interpreter.prompt?command_line.prompt(function(command){interpreter.prompt(command,self)}):command_line.prompt(interpreter.prompt),command_line.set(""),silent||"function"!=typeof interpreter.onStart||interpreter.onStart(self)}function initialize(){prepare_top_interpreter(),show_greetings();var was_paused=!1;if("function"==typeof settings.onInit){onPause=function(){was_paused=!0};try{settings.onInit(self)}catch(e){throw display_exception(e,"OnInit"),e}finally{onPause=$.noop,was_paused||self.resume()}}}function complete_helper(command,string,commands){var test=command_line.get().substring(0,command_line.position());if(test===command){for(var regex=new RegExp("^"+$.terminal.escape_regex(string)),matched=[],i=commands.length;i--;)regex.test(commands[i])&&matched.push(commands[i]);if(1===matched.length)self.insert(matched[0].replace(regex,"")+" ");else if(matched.length>1)if(tab_count>=2)echo_command(command),self.echo(matched.join("	")),tab_count=0;else{var j,found=!1;loop:for(j=string.length;j<matched[0].length;++j){for(i=1;i<matched.length;++i)if(matched[0].charAt(j)!==matched[i].charAt(j))break loop;found=!0}found&&self.insert(matched[0].slice(0,j).replace(regex,""))}}}function ghost(){return in_login||command_line.mask()}function key_down(e){var result,i,top=interpreters.top();if("function"===$.type(top.keydown)&&(result=top.keydown(e,self),result!==undefined))return result;var completion;if(completion=settings.completion&&"boolean"!=$.type(settings.completion)&&!top.completion?settings.completion:top.completion,self.oneTime(10,function(){on_scrollbar_show_resize()}),"function"===$.type(settings.keydown)&&(result=settings.keydown(e,self),result!==undefined))return result;if(self.paused()){if(68===e.which&&e.ctrlKey){if(requests.length){for(i=requests.length;i--;){var r=requests[i];if(4!==r.readyState)try{r.abort()}catch(error){self.error(strings.ajaxAbortError)}}requests=[],self.resume()}return!1}}else{if(9!==e.which&&(tab_count=0),68===e.which&&e.ctrlKey)return in_login||(""===command_line.get()?interpreters.size()>1||settings.login!==undefined?self.pop(""):(self.resume(),self.echo("")):self.set_command("")),!1;if(76===e.which&&e.ctrlKey)self.clear();else{if(completion&&9===e.which){++tab_count;var string,command=command_line.get().substring(0,command_line.position()),strings=command.split(" ");if(1==strings.length)string=strings[0];else for(string=strings[strings.length-1],i=strings.length-1;i>0&&"\\"==strings[i-1][strings[i-1].length-1];i--)string=strings[i-1]+" "+string;switch($.type(completion)){case"function":completion(self,string,function(commands){complete_helper(command,string,commands)});break;case"array":complete_helper(command,string,completion);break;default:throw new Error($.terminal.defaults.strings.invalidCompletion)}return!1}if(86===e.which&&e.ctrlKey)return void self.oneTime(1,function(){scroll_to_bottom()});if(9===e.which&&e.ctrlKey){if(terminals.length()>1)return self.focus(!1),!1}else 34===e.which?self.scroll(self.height()):33===e.which?self.scroll(-self.height()):self.attr({scrollTop:self.attr("scrollHeight")})}}}var output_buffer=[],NEW_LINE=1,self=this;if(this.length>1)return this.each(function(){$.fn.terminal.call($(this),init_interpreter,$.extend({name:self.selector},options))});if(self.data("terminal"))return self.data("terminal");if(0===self.length)throw'Sorry, but terminal said that "'+self.selector+'" is not valid selector!';var scroll_object,prev_command,output,num_chars,num_rows,old_width,old_height,tab_count=0,lines=[],terminal_id=terminals.length(),in_login=!1,onPause=$.noop,dalyed_commands=[],settings=$.extend({},$.terminal.defaults,{name:self.selector},options||{}),strings=$.terminal.defaults.strings,enabled=settings.enabled,paused=!1;$.extend(self,$.omap({clear:function(){output.html(""),command_line.set(""),lines=[];try{settings.onClear(self)}catch(e){throw display_exception(e,"onClear"),e}return self.attr({scrollTop:0}),self},export_view:function(){if(in_login)throw new Exception(strings.notWhileLogin);return{prompt:self.get_prompt(),command:self.get_command(),position:command_line.position(),lines:lines.slice(0)}},import_view:function(view){if(in_login)throw new Exception(strings.notWhileLogin);return self.set_prompt(view.prompt),self.set_command(view.command),command_line.position(view.position),lines=view.lines,redraw(),self},exec:function(command,silent){return paused?dalyed_commands.push([command,silent]):commands(command,silent,!0),self},login:function(auth,infinite,success,error){if(in_login)throw new Error(strings.notWhileLogin);if("function"!=typeof auth)throw new Error(strings.loginIsNotAFunction);if(self.token(!0)&&self.login_name(!0))return"function"==typeof success&&success(),self;return settings.history&&command_line.history().disable(),in_login=!0,self.push(function(user){self.set_mask(!0).push(function(pass){try{auth.call(self,user,pass,function(token,silent){if(token){self.pop().pop(),settings.history&&command_line.history().enable();var name=self.prefix_name(!0)+"_";$.Storage.set(name+"token",token),$.Storage.set(name+"login",user),in_login=!1,"function"==typeof success&&success()}else infinite?(silent||self.error(strings.wrongPasswordTryAgain),self.pop().set_mask(!1)):(in_login=!1,silent||self.error(strings.wrongPassword),self.pop().pop()),"function"==typeof error&&error()})}catch(e){display_exception(e,"USER(authentication)")}},{prompt:strings.password+": "})},{prompt:strings.login+": "})},settings:settings,commands:function(){return interpreters.top().interpreter},setInterpreter:function(user_interpreter,login){function overwrite_interpreter(){self.pause(),make_interpreter(user_interpreter,login,function(result){self.resume();var top=interpreters.top();$.extend(top,result),prepare_top_interpreter(!0)})}"string"==$.type(user_interpreter)&&login?self.login(make_json_rpc_login(user_interpreter,login),!0,overwrite_interpreter):overwrite_interpreter()},greetings:function(){return show_greetings(),self},paused:function(){return paused},pause:function(){return onPause(),!paused&&command_line&&(paused=!0,self.disable(),command_line.hidden()),self},resume:function(){if(paused&&command_line){paused=!1,self.enable(),command_line.visible();var original=dalyed_commands;for(dalyed_commands=[];original.length;)self.exec.apply(self,original.shift());scroll_to_bottom()}return self},cols:function(){return num_chars},rows:function(){return num_rows},history:function(){return command_line.history()},next:function(){if(1===terminals.length())return self;var offsetTop=self.offset().top;self.height(),self.scrollTop();if(is_scrolled_into_view(self)){terminals.front().disable();var next=terminals.rotate().enable(),x=next.offset().top-50;$("html,body").animate({scrollTop:x},500);try{settings.onTerminalChange(next)}catch(e){throw display_exception(e,"onTerminalChange"),e}return next}return self.enable(),
$("html,body").animate({scrollTop:offsetTop-50},500),self},focus:function(toggle,silent){return self.oneTime(1,function(){if(1===terminals.length())if(toggle===!1)try{silent||settings.onBlur(self)===!1||self.disable()}catch(e){throw display_exception(e,"onBlur"),e}else try{silent||settings.onFocus(self)===!1||self.enable()}catch(e){throw display_exception(e,"onFocus"),e}else if(toggle===!1)self.next();else{var front=terminals.front();if(front!=self&&(front.disable(),!silent))try{settings.onTerminalChange(self)}catch(e){throw display_exception(e,"onTerminalChange"),e}terminals.set(self),self.enable()}}),self},enable:function(){return num_chars===undefined&&self.resize(),command_line&&(command_line.enable(),enabled=!0),self},disable:function(){return command_line&&(enabled=!1,command_line.disable()),self},enabled:function(){return enabled},signature:function(){var cols=self.cols(),i=15>cols?null:35>cols?0:55>cols?1:64>cols?2:75>cols?3:4;return null!==i?signatures[i].join("\n")+"\n":""},version:function(){return version},cmd:function(){return command_line},get_command:function(){return command_line.get()},set_command:function(command){return command_line.set(command),self},insert:function(string){if("string"==typeof string)return command_line.insert(string),self;throw"insert function argument is not a string"},set_prompt:function(prompt){return validate("prompt",prompt)&&("function"==typeof prompt?command_line.prompt(function(command){prompt(command,self)}):command_line.prompt(prompt),interpreters.top().prompt=prompt),self},get_prompt:function(){return interpreters.top().prompt},set_mask:function(display){return command_line.mask(display),self},get_output:function(raw){return raw?lines:$.map(lines,function(item){return"function"==typeof item[0]?item[0]():item[0]}).join("\n")},resize:function(width,height){width&&height&&(self.width(width),self.height(height)),width=self.width(),height=self.height();var new_num_chars=get_num_chars(self),new_num_rows=get_num_rows(self);return(new_num_chars!==num_chars||new_num_rows!==num_rows)&&(num_chars=new_num_chars,num_rows=new_num_rows,redraw(),"function"!=typeof settings.onResize||old_height===height&&old_width===width||settings.onResize(self),(old_height!==height||old_width!==width)&&(old_height=height,old_width=width)),self},flush:function(){try{var wrapper;if($.each(output_buffer,function(i,line){if(line===NEW_LINE)wrapper=$("<div></div>");else if("function"==typeof line){wrapper.appendTo(output);try{line(wrapper)}catch(e){display_exception(e,"USER:echo(finalize)")}}else $("<div/>").html(line).appendTo(wrapper).width("100%")}),settings.outputLimit>=0){var limit=0===settings.outputLimit?self.rows():settings.outputLimit,$lines=output.find("div div");if($lines.length>limit){var for_remove=$lines.slice(0,lines.length-limit+1),parents=for_remove.parent();for_remove.remove(),parents.each(function(){var self=$(this);self.is(":empty")&&self.remove()})}}scroll_to_bottom(),output_buffer=[]}catch(e){alert("[Flush] "+exception_message(e)+"\n"+e.stack)}return self},echo:function(string,options){try{string=string||"";var settings=$.extend({flush:!0,raw:!1,finalize:$.noop},options||{});output_buffer=[],draw_line(string,settings),lines.push([string,settings]),settings.flush&&self.flush(),on_scrollbar_show_resize()}catch(e){alert("[Terminal.echo] "+exception_message(e)+"\n"+e.stack)}return self},error:function(message,finalize){return self.echo("[[;#f00;]"+$.terminal.escape_brackets(message).replace(/\\$/,"&#92;")+"]",finalize)},exception:function(e,label){var message=exception_message(e);label&&(message="&#91;"+label+"&#93;: "+message),message&&self.error(message,{finalize:function(div){div.addClass("exception message")}}),"string"==typeof e.fileName&&(self.pause(),$.get(e.fileName,function(file){self.resume();var num=e.lineNumber-1,line=file.split("\n")[num];line&&self.error("&#91;"+e.lineNumber+"&#93;: "+line)})),e.stack&&self.error(e.stack,{finalize:function(div){div.addClass("exception stack-trace")}})},scroll:function(amount){var pos;return amount=Math.round(amount),scroll_object.prop?(amount>scroll_object.prop("scrollTop")&&amount>0&&scroll_object.prop("scrollTop",0),pos=scroll_object.prop("scrollTop"),scroll_object.scrollTop(pos+amount)):(amount>scroll_object.attr("scrollTop")&&amount>0&&scroll_object.attr("scrollTop",0),pos=scroll_object.attr("scrollTop"),scroll_object.scrollTop(pos+amount)),self},logout:settings.login?function(){for(;interpreters.size()>1;)self.pop();return self.pop()}:function(){self.error(strings.loginFunctionMissing)},token:settings.login?function(local){return $.Storage.get(self.prefix_name(local)+"_token")}:$.noop,login_name:settings.login?function(local){return $.Storage.get(self.prefix_name(local)+"_login")}:$.noop,name:function(){return interpreters.top().name},prefix_name:function(local){var name=(settings.name?settings.name+"_":"")+terminal_id;return local&&interpreters.size()>1&&(name+="_"+interpreters.map(function(intrp){return intrp.name}).slice(1).join("_")),name},push:function(interpreter,options){options=options||{},options.name=options.name||prev_command,options.prompt=options.prompt||options.name+" ";var top=interpreters.top();return top&&(top.mask=command_line.mask()),make_interpreter(interpreter,options.login,function(result){if(interpreters.push($.extend({},result,options)),options.login){var type=$.type(options.login);"function"==type?self.login(options.login,!1,prepare_top_interpreter,self.pop):("string"==$.type(interpreter)&&"string"==type||"boolean"==type)&&self.login(make_json_rpc_login(interpreter,options.login),!1,prepare_top_interpreter,self.pop)}else prepare_top_interpreter()}),self},pop:function(string){string!==undefined&&echo_command(string);var token=self.token(!0);if(1==interpreters.size())if(settings.login){if(global_logout(),"function"===$.type(settings.onExit))try{settings.onExit(self)}catch(e){throw display_exception(e,"onExit"),e}}else self.error(strings.canExitError);else{token&&logout();var current=interpreters.pop();if(prepare_top_interpreter(),"function"===$.type(current.onExit))try{current.onExit(self)}catch(e){throw display_exception(e,"onExit"),e}self.set_mask(interpreters.top().mask)}return self},level:function(){return interpreters.size()},reset:function(){for(self.clear();interpreters.size()>1;)interpreters.pop();return initialize(),self},purge:function(){var prefix=self.prefix_name()+"_",names=$.Storage.get(prefix+"interpreters");return $.each($.parseJSON(names),function(_,name){$.Storage.remove(name+"_commands"),$.Storage.remove(name+"_token"),$.Storage.remove(name+"_login")}),command_line.purge(),$.Storage.remove(prefix+"interpreters"),self},destroy:function(){return command_line.destroy().remove(),output.remove(),$(document).unbind(".terminal"),$(window).unbind(".terminal"),self.unbind("click, mousewheel"),self.removeData("terminal").removeClass("terminal"),settings.width&&self.css("width",""),settings.height&&self.css("height",""),self}},function(_,fun){return function(){try{return fun.apply(this,Array.prototype.slice.apply(arguments))}catch(e){throw"exec"!==_&&"resume"!==_&&display_exception(e,"TERMINAL"),e}}}));var on_scrollbar_show_resize=function(){var scroll_bars=have_scrollbars(self);return function(){scroll_bars!==have_scrollbars(self)&&(self.resize(),scroll_bars=have_scrollbars(self))}}();if(settings.width&&self.width(settings.width),settings.height&&self.height(settings.height),scroll_object=navigator.userAgent.toLowerCase().match(/(webkit)[ \/]([\w.]+)/)||"body"!=self[0].tagName.toLowerCase()?self:$("html"),$(document).bind("ajaxSend.terminal",function(e,xhr,opt){requests.push(xhr)}),output=$("<div>").addClass("terminal-output").appendTo(self),self.addClass("terminal"),("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(self.click(function(){self.find("textarea").focus()}),self.find("textarea").focus()),settings.login&&"function"==typeof settings.onBeforeLogin)try{settings.onBeforeLogin(self)}catch(e){throw display_exception(e,"onBeforeLogin"),e}var auth=settings.login;"string"!=typeof init_interpreter||"string"!=typeof settings.login&&!settings.login||(settings.login=make_json_rpc_login(init_interpreter,settings.login)),terminals.append(self);var interpreters,command_line;return make_interpreter(init_interpreter,auth,function(interpreter){if(interpreters=new Stack($.extend({name:settings.name,prompt:settings.prompt,greetings:settings.greetings},interpreter)),command_line=$("<div/>").appendTo(self).cmd({prompt:settings.prompt,history:settings.history,historyFilter:settings.historyFilter,historySize:settings.historySize,width:"100%",keydown:key_down,keypress:settings.keypress?function(e){return settings.keypress(e,self)}:null,onCommandChange:function(command){if("function"===$.type(settings.onCommandChange))try{settings.onCommandChange(command,self)}catch(e){throw display_exception(e,"onCommandChange"),e}scroll_to_bottom()},commands:commands}),enabled?self.focus(undefined,!0):self.disable(),$(document).bind("click.terminal",function(e){$(e.target).closest(".terminal").hasClass("terminal")||settings.onBlur(self)===!1||self.disable()}),self.click(function(e){self.enabled()||self.focus()}).mousedown(function(e){2==e.which&&self.insert(getSelectedText())}),settings.login?self.login(settings.login,!0,initialize):initialize(),self.is(":visible")&&(num_chars=get_num_chars(self),command_line.resize(num_chars),num_rows=get_num_rows(self)),self.oneTime(100,function(){$(window).bind("resize.terminal",function(){if(self.is(":visible")){var width=self.width(),height=self.height();(old_height!==height||old_width!==width)&&self.resize()}})}),$.event.special.mousewheel){var shift=!1;$(document).bind("keydown.terminal",function(e){e.shiftKey&&(shift=!0)}).bind("keyup.terminal",function(e){(e.shiftKey||16==e.which)&&(shift=!1)}),self.mousewheel(function(event,delta){shift||(delta>0?self.scroll(-40):self.scroll(40))})}}),self.data("terminal",self),self}}(jQuery);
